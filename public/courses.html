<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Home | Welcome</title>
    <link rel="icon" href="img/overlays/tut_facelogo.png" type="image/x-icon">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.11.2/css/all.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/mdb.min.css">
    <link rel="stylesheet" href="css/style.css">
    <script type="text/javascript" href="cache.js"></script>
</head>

<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark scrolling-navbar">
        <div class="container">

            <!-- Brand -->
            <a class="navbar-brand" href="./dashboard.html">
                <img src="img/overlays/tut_facelogo.png" width="50" alt="">
            </a>

            <!-- Collapse -->
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
                aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <!-- Links -->
            <div class="collapse navbar-collapse" id="navbarSupportedContent">

                <!-- Left -->
                <ul class="navbar-nav mr-auto">
                    <li class="nav-item active">
                        <a class="nav-link" href="./dashboard.html">Dashdoard
                            <span class="sr-only">(current)</span>
                        </a>
                    </li>
                    <li class="nav-item active">
                        <a class="nav-link" href="./myprofile.html">My Profile
                        </a>
                    </li>
                    <li class="nav-item active">
                        <a class="nav-link" href="./courses.html">Courses
                        </a>
                    </li>
                </ul>

                <!-- Right -->
                <ul class="navbar-nav nav-flex-icons">
                    <li class="nav-item">
                        <a class="nav-link" href="/logout" >
                            | <i class="fas fa-sign-out-alt"></i>
                        </a>
                    </li>
                </ul>

            </div>

        </div>
    </nav>
    <!-- Navbar -->

    <h1 align="center" style="color:white">Choose your career path</h1>

    <div class="container" style="margin-top: 50px;">

        <!--Grid row-->
        <div class="row">

            <!--COURSE 1 CARD-->
            <div class="col-md-4 mb-4">

                <!-- Card -->
                <div class="card gradient-card">

                    <div class="card-image" style="background-image: url(./img/overlays/card_bg_1.jpg)">

                        <!-- Content -->
                        <a href="#!">
                            <div class="text-white d-flex h-100 mask blue-gradient-rgba">
                                <div class="first-content align-self-center p-3">
                                    <h3 class="card-title">COMPUTER SYSTEMS</h3>
                                    <p class="lead mb-0">(NDCY03) - NQF Level 6</p>
                                </div>
                            </div>
                        </a>

                    </div>

                    <!-- Data -->
                    <div class="third-content ml-auto mr-4 mb-2">
                        <p class="text-uppercase text-muted">Required APS</p>
                        <h4 class="font-weight-bold float-right" id="NDCY03_aps">24</h4>
                    </div>

                    <!-- Content -->
                    <div class="card-body white">
                        <button type="button" id="btn-1" class="btn btn-primary mt-5 float-right"
                            onclick="openModal(1,'COMPUTER SYSTEMS (NDCY03) - NQF Level 6',24,4,4,4)">
                            Apply
                        </button>
                        <h4 class="text-uppercase font-weight-bold my-4">Requirements</h4>
                        <p class="text-muted" align="justify">English: <strong id="NDCY03_english">4</strong></p>
                        <p class="text-muted" align="justify">Mathematics: <strong id="NDCY03_math">4</strong></p>
                        <p class="text-muted" align="justify">Physical Science: <strong id="NDCY03_physics">4</strong>
                        </p>
                        <p class="hide" id="course_no">1</p>
                    </div>

                    <div>

                    </div>

                </div>
                <!-- Card -->

            </div>
            <!--COURSE 1 CARD-->

            <!--COURSE 2 CARD-->
            <div class="col-md-4 mb-4">
            
                <!-- Card -->
                <div class="card gradient-card">
            
                    <div class="card-image" style="background-image: url(./img/overlays/card_bg_1.jpg)">
            
                        <!-- Content -->
                        <a href="#!">
                            <div class="text-white d-flex h-100 mask blue-gradient-rgba">
                                <div class="first-content align-self-center p-3">
                                    <h3 class="card-title">COMPUTER SYSTEMS (Extended)</h3>
                                    <p class="lead mb-0">(NDCYF0) - NQF Level 6</p>
                                </div>
                            </div>
                        </a>
            
                    </div>
            
                    <!-- Data -->
                    <div class="third-content ml-auto mr-4 mb-2">
                        <p class="text-uppercase text-muted">Required APS</p>
                        <h4 class="font-weight-bold float-right" id="NDCY03_aps">20</h4>
                    </div>
            
                    <!-- Content -->
                    <div class="card-body white">
                        <button type="button" id="btn-1" class="btn btn-primary mt-5 float-right"
                            onclick="openModal(2,'COMPUTER SYSTEMS (Extended) (NDCYF0) - NQF Level 6',20,3,3,3)">
                            Apply
                        </button>
                        <h4 class="text-uppercase font-weight-bold my-4">Requirements</h4>
                        <p class="text-muted" align="justify">English: <strong id="NDCY03_english">3</strong></p>
                        <p class="text-muted" align="justify">Mathematics: <strong id="NDCY03_math">3</strong></p>
                        <p class="text-muted" align="justify">Physical Science: <strong id="NDCY03_physics">3</strong>
                        </p>
                        <p class="hide" id="course_no">2</p>
                    </div>
            
                    <div>
            
                    </div>
            
                </div>
                <!-- Card -->
            
            </div>
            <!--COURSE 2 CARD-->

            <!--COURSE 3 CARD-->
            <div class="col-md-4 mb-4">
            
                <!-- Card -->
                <div class="card gradient-card">
            
                    <div class="card-image" style="background-image: url(./img/overlays/card_bg_1.jpg)">
            
                        <!-- Content -->
                        <a href="#!">
                            <div class="text-white d-flex h-100 mask blue-gradient-rgba">
                                <div class="first-content align-self-center p-3">
                                    <h3 class="card-title">INFORMATION TECHNOLOGY</h3>
                                    <p class="lead mb-0">(NDIT12) - NQF Level 6</p>
                                </div>
                            </div>
                        </a>
            
                    </div>
            
                    <!-- Data -->
                    <div class="third-content ml-auto mr-4 mb-2">
                        <p class="text-uppercase text-muted">Required APS</p>
                        <h4 class="font-weight-bold float-right" id="NDCY03_aps">18</h4>
                    </div>
            
                    <!-- Content -->
                    <div class="card-body white">
                        <button type="button" id="btn-1" class="btn btn-primary mt-5 float-right"
                            onclick="openModal(3,'INFORMATION TECHNOLOGY (NDIT12) - NQF Level 6',18,3,4,0)">
                            Apply
                        </button>
                        <h4 class="text-uppercase font-weight-bold my-4">Requirements</h4>
                        <p class="text-muted" align="justify">English: <strong id="NDCY03_english">3</strong></p>
                        <p class="text-muted" align="justify">Mathematics: <strong id="NDCY03_math">4</strong></p>
                        <p class="text-muted hide" align="justify">Physical Science: <strong id="NDCY03_physics">0</strong>
                        </p>
                        <p class="hide" id="course_no">3</p>
                    </div>
            
                    <div>
            
                    </div>
            
                </div>
                <!-- Card -->
            
            </div>
            <!--COURSE 3 CARD-->

            <!--COURSE 4 CARD-->
            <div class="col-md-4 mb-4">
            
                <!-- Card -->
                <div class="card gradient-card">
            
                    <div class="card-image" style="background-image: url(./img/overlays/card_bg_1.jpg)">
            
                        <!-- Content -->
                        <a href="#!">
                            <div class="text-white d-flex h-100 mask blue-gradient-rgba">
                                <div class="first-content align-self-center p-3">
                                    <h3 class="card-title">INFORMATION TECHNOLOGY (Extended)</h3>
                                    <p class="lead mb-0">(NDITF1) - NQF Level 6</p>
                                </div>
                            </div>
                        </a>
            
                    </div>
            
                    <!-- Data -->
                    <div class="third-content ml-auto mr-4 mb-2">
                        <p class="text-uppercase text-muted">Required APS</p>
                        <h4 class="font-weight-bold float-right" id="NDCY03_aps">18</h4>
                    </div>
            
                    <!-- Content -->
                    <div class="card-body white">
                        <button type="button" id="btn-1" class="btn btn-primary mt-5 float-right"
                            onclick="openModal(4,'INFORMATION TECHNOLOGY (Extended) (NDITF1) - NQF Level 6',18,3,3,0)">
                            Apply
                        </button>
                        <h4 class="text-uppercase font-weight-bold my-4">Requirements</h4>
                        <p class="text-muted" align="justify">English: <strong id="NDCY03_english">3</strong></p>
                        <p class="text-muted" align="justify">Mathematics: <strong id="NDCY03_math">3</strong></p>
                        <p class="text-muted hide" align="justify">Physical Science: <strong id="NDCY03_physics">0</strong>
                        </p>
                        <p class="hide" id="course_no">4</p>
                    </div>
            
                    <div>
            
                    </div>
            
                </div>
                <!-- Card -->
            
            </div>
            <!--COURSE 4 CARD-->

            <!--COURSE 5 CARD-->
            <div class="col-md-4 mb-4">
            
                <!-- Card -->
                <div class="card gradient-card">
            
                    <div class="card-image" style="background-image: url(./img/overlays/card_bg_1.jpg)">
            
                        <!-- Content -->
                        <a href="#!">
                            <div class="text-white d-flex h-100 mask blue-gradient-rgba">
                                <div class="first-content align-self-center p-3">
                                    <h3 class="card-title">BUSINESS APPLICATIONS (IT)</h3>
                                    <p class="lead mb-0">(NDIB12) - NQF Level 6</p>
                                </div>
                            </div>
                        </a>
            
                    </div>
            
                    <!-- Data -->
                    <div class="third-content ml-auto mr-4 mb-2">
                        <p class="text-uppercase text-muted">Required APS</p>
                        <h4 class="font-weight-bold float-right" id="NDCY03_aps">18</h4>
                    </div>
            
                    <!-- Content -->
                    <div class="card-body white">
                        <button type="button" id="btn-1" class="btn btn-primary mt-5 float-right"
                            onclick="openModal(5,'BUSINESS APPLICATIONS (IT) (NDIB12) - NQF Level 6',18,3,4,0)">
                            Apply
                        </button>
                        <h4 class="text-uppercase font-weight-bold my-4">Requirements</h4>
                        <p class="text-muted" align="justify">English: <strong id="NDCY03_english">3</strong></p>
                        <p class="text-muted" align="justify">Mathematics: <strong id="NDCY03_math">4</strong></p>
                        <p class="text-muted hide" align="justify">Physical Science: <strong id="NDCY03_physics">0</strong>
                        </p>
                        <p class="hide" id="course_no">5</p>
                    </div>
            
                    <div>
            
                    </div>
            
                </div>
                <!-- Card -->
            
            </div>
            <!--COURSE 5 CARD-->

        </div>
        <!--Grid row-->
    </div>



    <!-- Modal: modalPoll -->
    <div class="modal fade right" id="modalPoll-1" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
        aria-hidden="true" data-backdrop="false">
        <div class="modal-dialog modal-full-height modal-right modal-notify modal-info" role="document">
            <div class="modal-content">
                <!--Header-->
                <div class="modal-header">
                    <p class="heading lead" id="modal_course">
                    </p>

                    <button type="button" class="close" onclick="closeModal()" aria-label="Close">
                        <span aria-hidden="true" class="white-text">Ã—</span>
                    </button>
                </div>

                <!--Body-->
                <div class="modal-body">
                    <div class="text-center">
                        <i class="far fa-file-alt fa-4x mb-3 animated rotateIn"></i>
                        <p>
                            <strong>Your opinion matters</strong>
                        </p>
                        <p>Discover your ranking below and send your application.
                        </p>
                    </div>

                    <hr>

                    <!-- Radio -->
                    <p class="text-center">
                        <strong>Your rank</strong>
                    </p>
                    <h1 align="center" id='rank_status'></h1>
                    
                    <!-- Radio -->

                    <p class="text-center" id="ranking_message"></p>
                    <ul id="ava_courses"></ul>

                    <div class="hide" style="height: 2px;">
                        <p id="learner_aps"></p>
                        <p id="learner_eng"></p>
                        <p id="learner_math"></p>
                        <p id="learner_phy"></p>
                        <p id="learner_email"></p>
                        <p id="course_id_number"></p>
                    </div>

                </div>

                <!--Footer-->
                <div class="modal-footer justify-content-center">
                    <form action="">
                        <button type="button" onclick="send_application()" id="sendbtn" class="btn btn-primary waves-effect waves-light">Send
                            <i class="fa fa-paper-plane ml-1"></i>
                        </button>
                        <a type="button" class="btn btn-outline-primary waves-effect" onclick="closeModal()">Cancel</a>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- Modal: modalPoll -->


    <script type="text/javascript" src="js/jquery.min.js"></script>
    <script type="text/javascript" src="js/popper.min.js"></script>
    <script type="text/javascript" src="js/bootstrap.min.js"></script>
    <script type="text/javascript" src="js/mdb.min.js"></script>
    <script type="text/javascript">
        // Animations initialization
        //new WOW().init();

        var button_id;
            var course_id;
            var course_name;
            var course_aps;
            var course_eng;
            var course_math;
            var course_phy;

            var student_aps;
                var student_eng;
                var student_math;
                var student_phy;

        function changeOne(course) {
            $('#btn-one').html('<span class="spinner-border spinner-border-sm mr-2" role="status" aria-hidden="true"></span>Applying...').attr('disabled', true);
        }

        function changeTwo(course) {
            $('#btn-two').html('<span class="spinner-border spinner-border-sm mr-2" role="status" aria-hidden="true"></span>Applying...').attr('disabled', true);
        }

        function removechange() {
            $('#btn-one').html('Apply').attr('disabled', false);
            $('#btn-two').html('Apply').attr('disabled', false);
        }

        function openModal(id, course, aps, eng, math, phy) {

            course_id = id;
            button_id = '#btn-' + course_id;
            course_name = course;
            course_aps = aps;
            course_eng = eng;
            course_math = math;
            course_phy = phy;
            $('#modal_course').html(course_name);
            $('#modalPoll-1').addClass('show').attr('style', 'display:block;');
            $(button_id).html('<span class="spinner-border spinner-border-sm mr-2" role="status" aria-hidden="true"></span>Applying...').attr('disabled', true);

           document.getElementById("course_id_number").innerHTML = course_id;
            retrieve_data(course_aps, course_eng, course_math, course_phy);

        }

        function closeModal() {

            $('#modalPoll-1').removeClass('show').attr('style', 'display:none;');
            $(button_id).html('Apply').attr('disabled', false);

        }


        function status_check(aps, eng, math, phy){
            var xmlhttp = new XMLHttpRequest();
            xmlhttp.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                   
                    var obj = JSON.parse(this.responseText);
                    var x;
                    var text = "";
                    var message = "";

                    if(obj.length > 0){
                        for (x in obj) {
                            text += "<li>" + obj[x].course_name + " APS:" + obj[x].aps + "</li>";
                        }
                        message = "Your ranking does not meet the course requirements. Please consider the below alternative courses.";
                    }else{
                        message = "We regret to inform you that your marks are too low to be ranked in any of our courses.";
                    }
  
                    document.getElementById("ava_courses").innerHTML = text;
                    document.getElementById("ranking_message").innerHTML = message;
            
                }
            };
            xmlhttp.open("GET", "/get_courses/"+aps+"/"+eng+"/"+math+"/"+phy+"", true);
            xmlhttp.send();
        }

        function retrieve_data(aps, eng, math, phy) {

            //onload = "retrieve_data(24,4,4,4)"
            var student_aps;
            var student_eng;
            var student_math;
            var student_phy;
            var student_email;
            var text = 'Your ranking is looking good. The higher the rank, the better your chances are to be accepted. Send your application to complete the process.';

                var xmlhttp = new XMLHttpRequest();
                xmlhttp.onreadystatechange = function () {
                    if (this.readyState == 4 && this.status == 200) {

                        var obj = JSON.parse(this.responseText);
                        var x;
                        var rank = 0;                   

                        for (x in obj) {
                            student_aps = obj[x].aps_score;
                            student_eng = obj[x].english;
                            student_math = obj[x].maths;
                            student_phy = obj[x].physics;
                            student_email = obj[x].email;
                        }
                       
                        //compare aps first
                        if(student_aps >= aps){
                            if (student_eng >= eng) {
                                if (student_math >= math) {
                                    if (phy > 0) {
                                        if (student_phy >= phy) {
                                            rank = (student_aps - aps) + (student_eng - eng) + (student_math - math) + (student_phy - phy);
                                            document.getElementById("ranking_message").innerHTML = text;
                                  
                                    } else {
                                            status_check(student_aps, student_eng, student_math, student_phy);
                                            
                                        }
                                    } else {
                                        rank = (student_aps - aps) + (student_eng - eng) + (student_math - math);
                                       
                                        document.getElementById("ranking_message").innerHTML = text;
                                    }
                                } else {
                                    status_check(student_aps, student_eng, student_math, student_phy);
                                }
                            } else {
                                status_check(student_aps, student_eng, student_math, student_phy);
                            }   
                        }else{
                            status_check(student_aps, student_eng, student_math, student_phy);
                        }
                        
                        document.getElementById("rank_status").innerHTML = rank;

                        //--------------------for application----------------------//

                        document.getElementById("learner_aps").innerHTML = student_aps;
                        document.getElementById("learner_eng").innerHTML = student_eng;
                        document.getElementById("learner_math").innerHTML = student_math;
                        document.getElementById("learner_phy").innerHTML = student_phy;
                        document.getElementById("learner_email").innerHTML = student_email;
                                              
                    }
                };
                xmlhttp.open("GET", "/active_user", true);
                xmlhttp.send();
            
                
            }

            function send_application() {
                    var course_id = document.getElementById("course_no").innerHTML;
                    var email = document.getElementById("learner_email").innerHTML;
                    var rank = document.getElementById("rank_status").innerHTML;

                    var xmlhttp = new XMLHttpRequest();
                    xmlhttp.onreadystatechange = function () {
                        if (this.readyState == 4 && this.status == 200) {

                            var obj = this.responseText;
                            var x;

                            if (obj == "success") {
                                $("#sendbtn").html('Applyied').attr('disabled', true).removeClass('btn-primary').addClass('btn-success');
                            } else {
                                $("#sendbtn").html('Unsuccessful').attr('disabled', true).removeClass('btn-primary').addClass('btn-warning');
                            }

                        }
                    };
                    xmlhttp.open("GET", "/apply/" + course_id + "/" + email + "/" + rank + "", true);
                    xmlhttp.send();
                }

                function signout() {

                        var xmlhttp = new XMLHttpRequest();
                        xmlhttp.onreadystatechange = function () {
                            if (this.readyState == 4 && this.status == 200) {

                                var obj = this.responseText;
                                var x;

                            }
                        };
                        xmlhttp.open("GET", "/logout", true);
                        xmlhttp.send();
                    }

    </script>
</body>

</html>